<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>게시글 입력</title>
    <style>
        .board_image_result img {
            max-width: 300px;
            max-height: 300px;
        }
    </style>
</head>
<body>
<div class="normal_form" th:if="${tab =='일반'}">
    <form th:object="${boardDto}" action="/board/insertBoard" method="post">
        <input type="hidden" name="user_id" th:value="${user_id}">
        <div class="board_element">
            <label for="id_title">게시글 제목</label>
            <br>
            <input type="text" id="id_title" name="title" >
        </div>
        <br>

        <div class="board_element">
            <label for="id_tab">게시글 탭</label>
            <input type="hidden" name="tab" th:value="${tab}">
            <p id="id_tab" th:text="${tab}"></p>
        </div>
        <br>

        <div class="board_element">
            <label for="id_content">게시글 내용</label>
            <br>
            <textarea id="id_content" name="content" rows="10" cols="30"></textarea>
        </div>
        <br>

        <div class="board_element">
            <label for="id_writer">작성자 아이디</label>
            <input type="hidden" name="user_login_Id" th:value="${writer}">
            <p id="id_writer" th:text="${writer}"></p>
        </div>
        <br>

    </form>

</div>

<div class="review_from" th:if="${tab =='리뷰'}">
    <form th:object="${boardDto}" action="/board/insertBoard" method="post">
        <input type="hidden" name="user_id" th:value="${user_id}">
        <div class="board_element">
            <label for="review_title">게시글 제목</label>
            <br>
            <input type="text" id="review_title" name="title" >
        </div>
        <br>

        <div class="board_element">
            <label for="review_tab">게시글 탭</label>
            <input type="hidden" name="tab" th:value="${tab}">
            <p id="review_tab" th:text="${tab}"></p>
        </div>
        <br>

        <div class="board_element">
            <label for="review_content">게시글 내용</label>
            <br>
            <textarea id="review_content" name="content" rows="10" cols="30"></textarea>
        </div>
        <br>

        <div class="board_element">
            <label for="review_writer">작성자 아이디</label>
            <input type="hidden" name="user_login_Id" th:value="${writer}">
            <p id="review_writer" th:text="${writer}"></p>
        </div>
        <br>

        <div class="board_element">
            <label for="review_attraction">관광지</label>
            <input type="text" id="review_attraction" name="attraction" >

        </div>

        <div class="board_element">
            <label for="review_image">리뷰 이미지 업로드</label>
            <input class="board_image" type="file" id="review_image" name="tempImage" />
            <button class="uploadBtn" type="button">업로드</button>

        </div>
        <div class="board_image_result">

        </div>
        <br>

    </form>

</div>

<div th:if="${tab =='문의'}">
    <form th:object="${boardDto}" action="/board/insertBoard" method="post">
        <input type="hidden" name="user_id" th:value="${user_id}">
        <div class="board_element">
            <label for="inquiry_title">게시글 제목</label>
            <br>
            <input type="text" id="inquiry_title" name="title" >
        </div>
        <br>

        <div class="board_element">
            <label for="inquiry_tab">게시글 탭</label>
            <input type="hidden" name="tab" th:value="${tab}" disabled>
            <p id="inquiry_tab" th:text="${tab}"></p>
        </div>
        <br>

        <div class="board_element">
            <label for="inquiry_content">게시글 내용</label>
            <br>
            <textarea id="inquiry_content" name="content" rows="10" cols="30"></textarea>
        </div>
        <br>

        <div class="board_element">
            <label for="inquiry_writer">작성자 아이디</label>
            <input type="hidden" name="user_login_Id" th:value="${writer}" disabled>
            <p id="inquiry_writer" th:text="${writer}"></p>
        </div>
        <br>

        <div class="board_element">
            <label for="inquiry_image">문의 이미지 업로드</label>
            <input class="board_image" type="file" id="inquiry_image" name="tempImage" />
            <button class="uploadBtn" type="button">업로드</button>
        </div>
        <div class="board_image_result">

        </div>

    </form>

</div>

<div th:if="${tab =='신고'}">
    <form th:object="${boardDto}" action="/board/insertBoard" method="post">
        <input type="hidden" name="user_id" th:value="${user_id}">
        <div class="board_element">
            <label for="report_title">게시글 제목</label>
            <br>
            <input type="text" id="report_title" name="title" >
        </div>
        <br>

        <div class="board_element">
            <label for="report_tab">게시글 탭</label>
            <input type="hidden" name="tab" th:value="${tab}" disabled>
            <p id="report_tab" th:text="${tab}"></p>
        </div>
        <br>

        <div class="board_element">
            <label for="report_content">게시글 내용</label>
            <br>
            <textarea id="report_content" name="content" rows="10" cols="30"></textarea>
        </div>
        <br>

        <div class="board_element">
            <label for="report_writer">작성자 아이디</label>
            <input type="hidden" name="user_login_Id" th:value="${writer}" disabled>
            <p id="report_writer" th:text="${writer}"></p>
        </div>
        <br>

        <div class="board_element">
            <label for="report_image">신고 이미지 업로드</label>
            <input class="board_image" type="file" id="report_image" name="tempImage" />
            <button class="uploadBtn" type="button">업로드</button>
        </div>
        <div class="board_image_result">

        </div>
    </form>

</div>

<div th:if="${tab =='공지'}">
    <form th:object="${boardDto}" action="/board/insertBoard" method="post">
        <input type="hidden" name="user_id" th:value="${user_id}">
        <div class="board_element">
            <label for="announce_title">게시글 제목</label>
            <br>
            <input type="text" id="announce_title" name="title" >
        </div>
        <br>

        <div class="board_element">
            <label for="announce_tab">게시글 탭</label>
            <input type="hidden" name="tab" th:value="${tab}" disabled>
            <p id="announce_tab" th:text="${tab}"></p>
        </div>
        <br>

        <div class="board_element">
            <label for="announce_content">게시글 내용</label>
            <br>
            <textarea id="announce_content" name="content" rows="10" cols="30"></textarea>
        </div>
        <br>

        <div class="board_element">
            <label for="announce_writer">작성자 아이디</label>
            <input type="hidden" name="user_login_Id" th:value="${writer}" disabled>
            <p id="announce_writer" th:text="${writer}"></p>
        </div>
        <br>

        <div class="board_element">
            <label for="announce_image">공지 이미지 업로드</label>
            <input class="board_image" type="file" id="announce_image" name="tempImage" />
            <button class="uploadBtn" type="button">업로드</button>

        </div>
        <div class="board_image_result">

        </div>

    </form>

</div>
<div class="boardImageList">

</div>
    <button class="boardFormTempSubmit">임시저장</button>
    <button class="boardFormSubmit">작성</button>
    <a href="/board/list">목록으로</a>
<script>
    var fileInput=document.querySelector('.board_image');
    var ImageFileDataList=document.querySelector('.boardImageList');
    var fileTempUploadButton = document.querySelector('.uploadBtn');
    var ImageTempResult = document.querySelector('.board_image_result')
    var imageIndex = 0;

    fileTempUploadButton.addEventListener('click', function(e) {
        e.preventDefault();

        var formData = new FormData();
        var imgFile=fileInput.files[0];

        if(imgFile==null){
            alert('업로드할 파일을 선택하세요.');
            return;
        }

        formData.append('tempImage',imgFile);

        fetch('/image/TempSave',{
         method: 'POST',
         body: formData,
        credentials: "include"
        })
        .then(response => response.json())
        .then(data => {
            // UUIDName 받아서 boardImageList 에 추가하고 정상적으로 추가되면 이미지를 사용자에게 보여준다.
            var ImageDTO=data.ImageDTO;
            console.log(ImageDTO);
            ImageFileDataList.innerHTML  += '<div class="imageDTOValue">' +
            '<input type="hidden" name="boardImageDtoList[' + imageIndex + '].imageSize" value="' + ImageDTO['imageSize'] + '">' +
            '<input type="hidden" name="boardImageDtoList[' + imageIndex + '].isTemporary" value="' + ImageDTO['isTemporary'] + '">' +
            '<input type="hidden" name="boardImageDtoList[' + imageIndex + '].name" value="' + ImageDTO['name'] + '">' +
            '<input type="hidden" name="boardImageDtoList[' + imageIndex + '].uuid" value="' + ImageDTO['uuid'] + '">' +
            '<input type="hidden" name="boardImageDtoList[' + imageIndex + '].uuidname" value="' + ImageDTO['uuidname'] + '">' +
            '</div>';
            imageIndex++;
            //document.querySelector('.board_image_result').innerHTML += '<img src="/resources/upload/' + ImageDTO['uuidname'] + '" alt="board_image">';

        });

    })

    var submitButton = document.querySelector('.boardFormSubmit');
    submitButton.addEventListener('click', function(e) {
        e.preventDefault();

        var form = document.querySelector('form');
        form.submit();
    });


</script>
</body>
</html>